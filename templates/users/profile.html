{% extends 'base.html' %}
{% block title %}{{ user_profile.get_full_name }} - Profile{% endblock %}

{% block content %}
<style>
    :root {
        --neon-primary: #00ffcc;
        --neon-secondary: #00d4aa;
        --neon-glow: rgba(0, 255, 204, 0.4);
        --dark-bg: #0a0a0a;
        --card-bg: #151515;
        --border-subtle: #222;
    }

    body {
        background: linear-gradient(135deg, #0a0a0a 0%, #1a1a1a 50%, #0f0f0f 100%);
        color: #f5f5f5;
        font-family: 'Inter', sans-serif;
    }

    h2 {
        font-size: 2rem;
        background: linear-gradient(135deg, var(--neon-primary), var(--neon-secondary));
        -webkit-background-clip: text;
        -webkit-text-fill-color: transparent;
        margin-bottom: 10px;
    }

    .stats-cards {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
        gap: 20px;
        margin: 30px 0;
    }

    .stats-card {
        background: var(--card-bg);
        border: 1px solid var(--border-subtle);
        border-radius: 15px;
        padding: 20px;
        text-align: center;
        transition: all 0.3s;
        box-shadow: 0 0 20px rgba(0,255,204,0.1);
    }

    .stats-card:hover {
        box-shadow: 0 0 30px var(--neon-glow), 0 0 60px var(--neon-glow);
        border-color: var(--neon-primary);
    }

    .stats-number {
        font-size: 2rem;
        font-weight: 800;
        background: linear-gradient(135deg, var(--neon-primary), var(--neon-secondary));
        -webkit-background-clip: text;
        -webkit-text-fill-color: transparent;
    }

    .stats-label {
        font-size: 0.9rem;
        color: #aaa;
        margin-top: 5px;
        text-transform: uppercase;
        letter-spacing: 0.5px;
    }

    table {
        width: 100%;
        border-collapse: collapse;
        margin-bottom: 40px;
        background: var(--card-bg);
        border-radius: 12px;
        overflow: hidden;
        box-shadow: 0 0 20px rgba(0,255,204,0.1);
    }

    th, td {
        padding: 12px 15px;
        text-align: left;
        border-bottom: 1px solid var(--border-subtle);
    }

    th {
        background: linear-gradient(135deg, var(--neon-primary), var(--neon-secondary));
        color: #000;
        text-transform: uppercase;
        font-size: 0.9rem;
        letter-spacing: 0.5px;
    }

    tr:hover {
        background: rgba(0,255,204,0.05);
    }

    .section-title {
        font-size: 1.5rem;
        font-weight: 700;
        margin: 20px 0;
        background: linear-gradient(135deg, var(--neon-primary), var(--neon-secondary));
        -webkit-background-clip: text;
        -webkit-text-fill-color: transparent;
    }

    a.btn-back {
        display: inline-block;
        margin-bottom: 20px;
        color: var(--neon-primary);
        text-decoration: none;
        font-weight: 600;
        transition: all 0.3s;
    }

    a.btn-back:hover {
        text-shadow: 0 0 10px var(--neon-glow);
    }

    .badge-info {
        display: inline-block;
        padding: 5px 15px;
        background: rgba(0, 255, 204, 0.1);
        border: 1px solid var(--neon-primary);
        border-radius: 20px;
        color: var(--neon-primary);
        font-size: 0.85rem;
        margin-top: 10px;
    }
</style>

<div class="profile-header">
    <h2>{{ user_profile.get_full_name }}'s Profile</h2>
    <p>Email: {{ user_profile.email }}</p>
    <p>Role: {{ user_profile.role|title }}</p>
    
    {% if is_own_profile %}
        <span class="badge-info">üë§ Your Profile</span>
    {% endif %}
    
    {% if viewer_is_admin and not is_own_profile %}
        <span class="badge-info">üëÅÔ∏è Admin View</span>
    {% endif %}
    
    <div style="margin-top: 15px;">
        {% if viewer_is_admin %}
            <a href="{% url 'superadmin_dashboard' %}" class="btn-back">‚Üê Back to Dashboard</a>
        {% else %}
            <a href="{% url 'game_list' %}" class="btn-back">‚Üê Back to Games</a>
        {% endif %}
    </div>
</div>

{# Analytics Section for Student Admin & Super Admin profiles #}
{% if user_profile.role == 'student_admin' or user_profile.role == 'super_admin' %}

<div class="stats-cards">
    <div class="stats-card">
        <div class="stats-number">{{ total_games_listed }}</div>
        <div class="stats-label">Games Listed</div>
    </div>
    
    <div class="stats-card">
        <div class="stats-number">{{ currently_rented_games }}</div>
        <div class="stats-label">Currently Rented</div>
    </div>
    
    <div class="stats-card">
        <div class="stats-number">{{ past_rentals_of_games }}</div>
        <div class="stats-label">Past Rentals</div>
    </div>
    
    {# Show financial details only to owner or super admin #}
    {% if show_financial_details %}
    <div class="stats-card">
        <div class="stats-number">‚Çπ{{ total_revenue_earned }}</div>
        <div class="stats-label">Revenue Earned</div>
    </div>
    {% endif %}
</div>

{# Games Listed Table - Show to everyone #}
<h3 class="section-title">Games Listed</h3>
<table>
    <tr>
        <th>Title</th>
        <th>Status</th>
        <th>Price/Day</th>
    </tr>
    {% for game in games_listed %}
    <tr>
        <td>{{ game.title }}</td>
        <td>{{ game.available|yesno:"Available,Rented" }}</td>
        <td>‚Çπ{{ game.price_per_day }}</td>
    </tr>
    {% empty %}
    <tr><td colspan="3">No games listed yet.</td></tr>
    {% endfor %}
</table>

{# Rentals Received - Show detailed info only to owner or super admin #}
{% if show_financial_details %}
<h3 class="section-title">Rentals of Your Games</h3>
<table>
    <tr>
        <th>Game</th>
        <th>Renter</th>
        <th>Status</th>
        <th>Payment</th>
        <th>Cost</th>
    </tr>
    {% for rental in rentals_received %}
    <tr>
        <td>{{ rental.game.title }}</td>
        <td>{{ rental.user.get_full_name }}</td>
        <td>{{ rental.status|title }}</td>
        <td>{{ rental.payment_status|title }}</td>
        <td>‚Çπ{{ rental.cost }}</td>
    </tr>
    {% empty %}
    <tr><td colspan="5">No rentals received yet.</td></tr>
    {% endfor %}
</table>
{% endif %}

{% endif %}

{# User's Rental History Section #}
<h3 class="section-title">
    {% if is_own_profile %}
        Your Rental History
    {% else %}
        {{ user_profile.get_full_name }}'s Rental Activity
    {% endif %}
</h3>

<div class="stats-cards">
    <div class="stats-card">
        <div class="stats-number">{{ total_rentals_made }}</div>
        <div class="stats-label">Total Rentals</div>
    </div>
    
    <div class="stats-card">
        <div class="stats-number">{{ active_rentals }}</div>
        <div class="stats-label">Active Rentals</div>
    </div>
    
    <div class="stats-card">
        <div class="stats-number">{{ completed_rentals }}</div>
        <div class="stats-label">Completed</div>
    </div>
    
    {# Show spending only to owner or super admin #}
    {% if show_financial_details %}
    <div class="stats-card">
        <div class="stats-number">‚Çπ{{ total_spent_on_rentals }}</div>
        <div class="stats-label">Total Spent</div>
    </div>
    {% endif %}
</div>

<table>
    <tr>
        <th>Game</th>
        <th>Status</th>
        {% if show_financial_details %}
        <th>Payment</th>
        <th>Cost</th>
        {% endif %}
    </tr>
    {% for rental in rentals_made %}
    <tr>
        <td>{{ rental.game.title }}</td>
        <td>{{ rental.status|title }}</td>
        {% if show_financial_details %}
        <td>{{ rental.payment_status|title }}</td>
        <td>‚Çπ{{ rental.cost }}</td>
        {% endif %}
    </tr>
    {% empty %}
    <tr><td colspan="{% if show_financial_details %}4{% else %}2{% endif %}">No rentals yet.</td></tr>
    {% endfor %}
</table>

{% endblock %}

{% comment %} {% extends 'base.html' %}
{% block title %}{{ user_profile.get_full_name }} - Profile{% endblock %}

{% block content %}
<style>
    :root {
        --neon-primary: #00ffcc;
        --neon-secondary: #00d4aa;
        --neon-glow: rgba(0, 255, 204, 0.4);
        --dark-bg: #0a0a0a;
        --card-bg: #151515;
        --border-subtle: #222;
    }

    body {
        background: linear-gradient(135deg, #0a0a0a 0%, #1a1a1a 50%, #0f0f0f 100%);
        color: #f5f5f5;
        font-family: 'Inter', sans-serif;
    }

    h2 {
        font-size: 2rem;
        background: linear-gradient(135deg, var(--neon-primary), var(--neon-secondary));
        -webkit-background-clip: text;
        -webkit-text-fill-color: transparent;
        margin-bottom: 10px;
    }

    .stats-cards {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
        gap: 20px;
        margin: 30px 0;
    }

    .stats-card {
        background: var(--card-bg);
        border: 1px solid var(--border-subtle);
        border-radius: 15px;
        padding: 20px;
        text-align: center;
        transition: all 0.3s;
        box-shadow: 0 0 20px rgba(0,255,204,0.1);
    }

    .stats-card:hover {
        box-shadow: 0 0 30px var(--neon-glow), 0 0 60px var(--neon-glow);
        border-color: var(--neon-primary);
    }

    .stats-number {
        font-size: 2rem;
        font-weight: 800;
        background: linear-gradient(135deg, var(--neon-primary), var(--neon-secondary));
        -webkit-background-clip: text;
        -webkit-text-fill-color: transparent;
    }

    .stats-label {
        font-size: 0.9rem;
        color: #aaa;
        margin-top: 5px;
        text-transform: uppercase;
        letter-spacing: 0.5px;
    }

    table {
        width: 100%;
        border-collapse: collapse;
        margin-bottom: 40px;
        background: var(--card-bg);
        border-radius: 12px;
        overflow: hidden;
        box-shadow: 0 0 20px rgba(0,255,204,0.1);
    }

    th, td {
        padding: 12px 15px;
        text-align: left;
        border-bottom: 1px solid var(--border-subtle);
    }

    th {
        background: linear-gradient(135deg, var(--neon-primary), var(--neon-secondary));
        color: #000;
        text-transform: uppercase;
        font-size: 0.9rem;
        letter-spacing: 0.5px;
    }

    tr:hover {
        background: rgba(0,255,204,0.05);
    }

    .section-title {
        font-size: 1.5rem;
        font-weight: 700;
        margin: 20px 0;
        background: linear-gradient(135deg, var(--neon-primary), var(--neon-secondary));
        -webkit-background-clip: text;
        -webkit-text-fill-color: transparent;
    }

    a.btn-back {
        display: inline-block;
        margin-bottom: 20px;
        color: var(--neon-primary);
        text-decoration: none;
        font-weight: 600;
        transition: all 0.3s;
    }

    a.btn-back:hover {
        text-shadow: 0 0 10px var(--neon-glow);
    }
</style>

<div class="profile-header">
    <h2>{{ user_profile.get_full_name }} Profile</h2>
    <p>Email: {{ user_profile.email }}</p>
    <p>Role: {{ user_profile.role|title }}</p>
    {% if viewing_as_admin %}
        <p><em>Viewing as Super Admin</em></p>
        <a href="{% url 'superadmin_dashboard' %}" class="btn-back">‚Üê Back to Users List</a>
    {% else %}
        <a href="{% url 'game_list' %}" class="btn-back">‚Üê Back to Games</a>
    {% endif %}
</div>




{% if user_profile.role == 'student_admin' or user_profile.role == 'super_admin' %}

<div class="stats-cards">
    <div class="stats-card">
        <div class="stats-number">{{ total_games_listed }}</div>
        <div class="stats-label">Games Listed</div>
    </div>
    <div class="stats-card">
        <div class="stats-number">{{ total_rentals_made }}</div>
        <div class="stats-label">Rentals Made</div>
    </div>
    <div class="stats-card">
        <div class="stats-number">{{ active_rentals }}</div>
        <div class="stats-label">Active Rentals</div>
    </div>
    <div class="stats-card">
        <div class="stats-number">{{ completed_rentals }}</div>
        <div class="stats-label">Completed Rentals</div>
    </div>
    <div class="stats-card">
        <div class="stats-number">‚Çπ{{ total_revenue_earned }}</div>
        <div class="stats-label">Revenue Earned</div>
    </div>
    <div class="stats-card">
        <div class="stats-number">‚Çπ{{ total_spent_on_rentals }}</div>
        <div class="stats-label">Spent on Rentals</div>
    </div>
</div>

<h3 class="section-title">Games Listed</h3>
<table>
    <tr>
        <th>Title</th>
        <th>Status</th>
        <th>Price/Day</th>
    </tr>
    {% for game in games_listed %}
    <tr>
        <td>{{ game.title }}</td>
        <td>{{ game.available|yesno:"Available,Rented" }}</td>
        <td>‚Çπ{{ game.price_per_day }}</td>
    </tr>
    {% empty %}
    <tr><td colspan="3">No games listed yet.</td></tr>
    {% endfor %}
</table>

<h3 class="section-title">Rentals of Listed Games</h3>
<table>
    <tr>
        <th>Game</th>
        <th>Renter</th>
        <th>Status</th>
        <th>Payment</th>
        <th>Cost</th>
    </tr>
    {% for rental in rentals_received %}
    <tr>
        <td>{{ rental.game.title }}</td>
        <td>{{ rental.user.get_full_name }}</td>
        <td>{{ rental.status|title }}</td>
        <td>{{ rental.payment_status|title }}</td>
        <td>‚Çπ{{ rental.cost }}</td>
    </tr>
    {% empty %}
    <tr><td colspan="5">No rentals yet.</td></tr>
    {% endfor %}
</table>
{% endif %}

<h3 class="section-title">Rental History</h3>
<table>
    <tr>
        <th>Game</th>
        <th>Status</th>
        <th>Payment</th>
        <th>Cost</th>
    </tr>
    {% for rental in rentals_made %}
    <tr>
        <td>{{ rental.game.title }}</td>
        <td>{{ rental.status|title }}</td>
        <td>{{ rental.payment_status|title }}</td>
        <td>‚Çπ{{ rental.cost }}</td>
    </tr>
    {% empty %}
    <tr><td colspan="4">No rentals yet.</td></tr>
    {% endfor %}
</table>
{% endblock %}
  {% endcomment %}